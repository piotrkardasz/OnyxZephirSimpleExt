# Generated by configure.js
PHP_SRC_DIR =C:\onyx\ext
PHP_CL=cl.exe 

PHP_COMPILER_SHORT=VC14 

PHP_ARCHITECTURE=x64 

LINK=C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\BIN\x86_amd64\link.exe 

NMAKE=nmake.exe 

MAKE_LIB=lib.exe 

BISON=bison.exe 

SED=sed.exe 

RE2C=re2c.exe 

RE2C_FLAGS= 

ZIP=zip.exe 

LEMON=lemon.exe 

MC=C:\Program Files (x86)\Windows Kits\10\bin\10.0.17134.0\x86\mc.exe 

MT=C:\Program Files (x86)\Windows Kits\10\bin\10.0.17134.0\x86\mt.exe 

PHP_PREFIX=C:\php 

BASE_INCLUDES=/I c:\phpdevpack/include /I c:\phpdevpack/include/main /I c:\phpdevpack/include/Zend /I c:\phpdevpack/include/TSRM /I c:\phpdevpack/include/ext 

CFLAGS_PHP_OBJ=$(CFLAGS_PHP) $(STATIC_EXT_CFLAGS) 

DLL_LDFLAGS=/dll 

PHP_LDFLAGS=$(DLL_LDFLAGS) /nodefaultlib:libcmt 

LIBS=kernel32.lib ole32.lib user32.lib advapi32.lib shell32.lib ws2_32.lib Dnsapi.lib psapi.lib 

ZTS=0 

PHP_ZTS_ARCHIVE_POSTFIX=-nts 

BUILD_DIR=C:\onyx\ext\x64\Release 

PHPDLL=php7.dll 

PHPLIB=php7.lib 

PHP_BUILD=C:\onyx\ext\no 

ARFLAGS=/libpath:"\"C:\onyx\ext\no\lib\"" 

SNAPSHOT_TEMPLATE=no 

PHP_DIR=c:\phpdevpack 

CFLAGS_PHP=/D _USRDLL /D PHP7DLLTS_EXPORTS /D PHP_EXPORTS /D LIBZEND_EXPORTS /D TSRM_EXPORTS /D SAPI_EXPORTS /D WINVER=0x0600 /D COMPILE_DL_ONYX 

CFLAGS_BD_ONYX_EXT=/Fp$(BUILD_DIR)\onyx\ext\ /FR$(BUILD_DIR)\onyx\ext\ /Fd$(BUILD_DIR)\onyx\ext\ 

EXT_TARGETS=php_onyx.dll 

CFLAGS_ONYX_OBJ=$(CFLAGS_ONYX) 

CFLAGS_BD_ONYX_EXT_KERNEL=/Fp$(BUILD_DIR)\onyx\ext\kernel\ /FR$(BUILD_DIR)\onyx\ext\kernel\ /Fd$(BUILD_DIR)\onyx\ext\kernel\ 

CFLAGS_BD_ONYX_EXT_ONYX=/Fp$(BUILD_DIR)\onyx\ext\onyx\ /FR$(BUILD_DIR)\onyx\ext\onyx\ /Fd$(BUILD_DIR)\onyx\ext\onyx\ 

ONYX_GLOBAL_OBJS=$(BUILD_DIR)\onyx\ext\onyx.obj $(BUILD_DIR)\onyx\ext\kernel\array.obj $(BUILD_DIR)\onyx\ext\kernel\backtrace.obj $(BUILD_DIR)\onyx\ext\kernel\concat.obj $(BUILD_DIR)\onyx\ext\kernel\debug.obj $(BUILD_DIR)\onyx\ext\kernel\exception.obj $(BUILD_DIR)\onyx\ext\kernel\exit.obj $(BUILD_DIR)\onyx\ext\kernel\fcall.obj $(BUILD_DIR)\onyx\ext\kernel\file.obj $(BUILD_DIR)\onyx\ext\kernel\filter.obj $(BUILD_DIR)\onyx\ext\kernel\iterator.obj $(BUILD_DIR)\onyx\ext\kernel\main.obj $(BUILD_DIR)\onyx\ext\kernel\math.obj $(BUILD_DIR)\onyx\ext\kernel\memory.obj $(BUILD_DIR)\onyx\ext\kernel\object.obj $(BUILD_DIR)\onyx\ext\kernel\operators.obj $(BUILD_DIR)\onyx\ext\kernel\require.obj $(BUILD_DIR)\onyx\ext\kernel\string.obj $(BUILD_DIR)\onyx\ext\kernel\time.obj $(BUILD_DIR)\onyx\ext\kernel\variables.obj $(BUILD_DIR)\onyx\ext\onyx\utils.obj $(BUILD_DIR)\onyx\ext\onyx\url.zep.obj 

ONYX_GLOBAL_OBJS_RESP=@"C:\onyx\ext\x64\Release\resp\ONYX_GLOBAL_OBJS.txt" 

CFLAGS_ONYX=/FI main/config.pickle.h /D COMPILE_DL_ONYX /D ONYX_EXPORTS=1 -IC:\onyx\ext /D ZEPHIR_RELEASE /Oi /Ot /Oy /Ob2 /Gs /GF /Gy /GL 

CFLAGS=/nologo $(BASE_INCLUDES) /D _WINDOWS /D ZEND_WIN32=1 /D PHP_WIN32=1 /D WIN32 /D _MBCS /W3 /FD /wd4996 /guard:cf /Zc:inline /MP /LD /MD /W3 /Ox /D NDebug /D NDEBUG /D ZEND_WIN32_FORCE_INLINE /GF /D ZEND_DEBUG=0 /I "C:\onyx\ext\no\include" /D ZEPHIR_RELEASE /Oi /Ot /Oy /Ob2 /Gs /GF /Gy /GL 

LDFLAGS=/nologo /GUARD:CF /libpath:"\"C:\onyx\ext\no\lib\"" /LTCG 

BUILD_DIRS_SUB=onyx onyx\ext onyx\ext\kernel onyx\ext\onyx 


CC="$(PHP_CL)"
LD="$(LINK)"
MC="$(MC)"
MT="$(MT)"

PHPSDK_DIR=$(PHP_DIR)
PHPLIB=$(PHPSDK_DIR)\lib\$(PHPLIB)
LDFLAGS=$(LDFLAGS) /libpath:"$(PHPSDK_DIR)\lib\;$(PHPSDK_DIR)"
BUILD_DIR_DEV=$(PHPSDK_DIR)

!if "$(DEBUGGER)" == "1"
DEBUGGER_CMD=devenv
DEBUGGER_ARGS=/debugexe
!else
DEBUGGER_CMD=
DEBUGGER_ARGS=
!endif

all: $(EXT_TARGETS) $(PECL_TARGETS)

build_dirs: $(BUILD_DIR) $(BUILD_DIRS_SUB)

clean-pecl:
	@echo Cleaning PECL targets only
	-rd /s /q $(BUILD_DIR)\pecl

clean-all:
	@echo Cleaning standard build dirs
	cd $(BUILD_DIR)
	@for %D in (_x $(BUILD_DIRS_SUB)) do @if exist %D @rd /s /q %D
	-@del /f /q $(BUILD_DIR)\*.res $(BUILD_DIR)\*.manifest $(BUILD_DIR)\*.lib $(BUILD_DIR)\*.ilk $(BUILD_DIR)\*.pdb $(BUILD_DIR)\*.exp $(PHPDEF) $(BUILD_DIR)\*.rc $(BUILD_DIR)\*.dbg $(BUILD_DIR)\*.bin $(BUILD_DIR)\php*.dll $(BUILD_DIR)\php*.exe > NUL

clean: clean-pecl
	@echo Cleaning distribution build dirs
	cd $(BUILD_DIR)
	@for %D in (_x $(BUILD_DIRS_SUB)) do @if exist %D @del /F /Q %D\*.* > NUL
	-@del /F /Q $(BUILD_DIR)\*.res $(BUILD_DIR)\*.lib $(BUILD_DIR)\*.ilk $(BUILD_DIR)\*.pdb $(BUILD_DIR)\*.exp $(PHPDEF) $(BUILD_DIR)\php-$(PHP_VERSION_STRING)-Win32.zip $(BUILD_DIR)\pecl-$(PHP_VERSION_STRING)-Win32.zip > NUL

!if "$(EXT_TARGETS)" == ""
_EXTENSION_DLL=$(PECL_TARGETS)
!else
_EXTENSION_DLL=$(EXT_TARGETS)
!endif

test: set-tmp-env
	$(DEBUGGER_CMD) $(DEBUGGER_ARGS) "$(PHP_PREFIX)\php.exe" -d open_basedir= -d output_buffering=0 run-tests.php $(TESTS) -p "$(PHP_PREFIX)\php.exe" -d extension=$(BUILD_DIR)\$(_EXTENSION_DLL)

run: set-tmp-env
	$(DEBUGGER_CMD) $(DEBUGGER_ARGS) "$(PHP_PREFIX)\php.exe" -n -d extension=$(BUILD_DIR)\\$(_EXTENSION_DLL) $(ARGS)

!if $(MT) == ""
_VC_MANIFEST_EMBED_EXE=
_VC_MANIFEST_EMBED_DLL=
!else
_VC_MANIFEST_EMBED_EXE= if exist $@.manifest $(MT) -nologo -manifest $@.manifest -outputresource:$@;1
_VC_MANIFEST_EMBED_DLL= if exist $@.manifest $(MT) -nologo -manifest $@.manifest -outputresource:$@;2
!endif

install: build-headers  build-bins

build-headers:
	@if not exist $(BUILD_DIR_DEV)\include mkdir $(BUILD_DIR_DEV)\include >nul
	@for %D in ($(INSTALL_HEADERS_DIR)) do @if not exist $(BUILD_DIR_DEV)\include\%D mkdir $(BUILD_DIR_DEV)\include\%D >nul
	@for %D in ($(INSTALL_HEADERS_DIR)) do @copy %D*.h $(BUILD_DIR_DEV)\include\%D /y >nul

build-bins:
	@copy $(BUILD_DIR)\php_onyx.lib $(BUILD_DIR_DEV)\lib
  @if not exist $(PHP_PREFIX) mkdir $(PHP_PREFIX) >nul
  @if not exist $(PHP_PREFIX)\ext mkdir $(PHP_PREFIX)\ext >nul
	@copy $(BUILD_DIR)\php_onyx.dll $(PHP_PREFIX)\ext

set-tmp-env:
	@set PATH=$(PHP_BUILD)\bin;$(PATH)


dump-tmp-env: set-tmp-env
	@set



# objects for EXT onyx

$(BUILD_DIR)\onyx\ext\onyx.obj: C:\onyx\ext\onyx.c
	$(CC) $(CFLAGS_ONYX_OBJ) $(CFLAGS) /Fo$(BUILD_DIR)\onyx\ext\ $(CFLAGS_BD_ONYX_EXT) /c C:\onyx\ext\onyx.c 

$(BUILD_DIR)\php_onyx.dll.res: $(PHP_DIR)\build\template.rc
	$(RC) /nologo  $(BASE_INCLUDES) /I $(PHP_DIR)/include /n /fo $(BUILD_DIR)\php_onyx.dll.res /d FILE_DESCRIPTION="\"php_onyx.dll\"" /d FILE_NAME="\"php_onyx.dll\"" /d URL="\"http://www.php.net\"" /d INTERNAL_NAME="\"ONYX extension\"" /d THANKS_GUYS="\"\"" $(PHP_DIR)\build\template.rc

$(BUILD_DIR)\php_onyx.dll.manifest: c:\phpdevpack\build\default.manifest
	@copy c:\phpdevpack\build\default.manifest $(BUILD_DIR)\php_onyx.dll.manifest >nul
$(BUILD_DIR)\php_onyx.lib: $(BUILD_DIR)\php_onyx.dll

$(BUILD_DIR)\php_onyx.dll: $(DEPS_ONYX) $(ONYX_GLOBAL_OBJS) $(PHPLIB) $(BUILD_DIR)\php_onyx.dll.res $(BUILD_DIR)\php_onyx.dll.manifest
	@"$(LINK)" $(ONYX_GLOBAL_OBJS_RESP) $(PHPLIB) $(LIBS_ONYX) $(LIBS) $(BUILD_DIR)\php_onyx.dll.res /out:$(BUILD_DIR)\php_onyx.dll $(DLL_LDFLAGS) $(LDFLAGS) $(LDFLAGS_ONYX)
	-@$(_VC_MANIFEST_EMBED_DLL)

php_onyx.dll: $(BUILD_DIR)\php_onyx.dll
	@echo EXT onyx build complete

$(BUILD_DIR)\onyx\ext\kernel\array.obj $(BUILD_DIR)\onyx\ext\kernel\backtrace.obj $(BUILD_DIR)\onyx\ext\kernel\concat.obj $(BUILD_DIR)\onyx\ext\kernel\debug.obj $(BUILD_DIR)\onyx\ext\kernel\exception.obj $(BUILD_DIR)\onyx\ext\kernel\exit.obj $(BUILD_DIR)\onyx\ext\kernel\fcall.obj $(BUILD_DIR)\onyx\ext\kernel\file.obj $(BUILD_DIR)\onyx\ext\kernel\filter.obj $(BUILD_DIR)\onyx\ext\kernel\iterator.obj $(BUILD_DIR)\onyx\ext\kernel\main.obj $(BUILD_DIR)\onyx\ext\kernel\math.obj $(BUILD_DIR)\onyx\ext\kernel\memory.obj $(BUILD_DIR)\onyx\ext\kernel\object.obj $(BUILD_DIR)\onyx\ext\kernel\operators.obj $(BUILD_DIR)\onyx\ext\kernel\require.obj $(BUILD_DIR)\onyx\ext\kernel\string.obj $(BUILD_DIR)\onyx\ext\kernel\time.obj $(BUILD_DIR)\onyx\ext\kernel\variables.obj: C:\onyx\ext\kernel\array.c C:\onyx\ext\kernel\backtrace.c C:\onyx\ext\kernel\concat.c C:\onyx\ext\kernel\debug.c C:\onyx\ext\kernel\exception.c C:\onyx\ext\kernel\exit.c C:\onyx\ext\kernel\fcall.c C:\onyx\ext\kernel\file.c C:\onyx\ext\kernel\filter.c C:\onyx\ext\kernel\iterator.c C:\onyx\ext\kernel\main.c C:\onyx\ext\kernel\math.c C:\onyx\ext\kernel\memory.c C:\onyx\ext\kernel\object.c C:\onyx\ext\kernel\operators.c C:\onyx\ext\kernel\require.c C:\onyx\ext\kernel\string.c C:\onyx\ext\kernel\time.c C:\onyx\ext\kernel\variables.c
	$(CC) $(CFLAGS_ONYX_OBJ) $(CFLAGS) /Fo$(BUILD_DIR)\onyx\ext\kernel\ $(CFLAGS_BD_ONYX_EXT_KERNEL) /c C:\onyx\ext\kernel\array.c C:\onyx\ext\kernel\backtrace.c C:\onyx\ext\kernel\concat.c C:\onyx\ext\kernel\debug.c C:\onyx\ext\kernel\exception.c C:\onyx\ext\kernel\exit.c C:\onyx\ext\kernel\fcall.c C:\onyx\ext\kernel\file.c C:\onyx\ext\kernel\filter.c C:\onyx\ext\kernel\iterator.c C:\onyx\ext\kernel\main.c C:\onyx\ext\kernel\math.c C:\onyx\ext\kernel\memory.c C:\onyx\ext\kernel\object.c C:\onyx\ext\kernel\operators.c C:\onyx\ext\kernel\require.c C:\onyx\ext\kernel\string.c C:\onyx\ext\kernel\time.c C:\onyx\ext\kernel\variables.c 
$(BUILD_DIR)\onyx\ext\onyx\utils.obj: C:\onyx\ext\onyx\utils.c
	$(CC) $(CFLAGS_ONYX_OBJ) $(CFLAGS) /Fo$(BUILD_DIR)\onyx\ext\onyx\ $(CFLAGS_BD_ONYX_EXT_ONYX) /c C:\onyx\ext\onyx\utils.c 
$(BUILD_DIR)\onyx\ext\onyx\url.zep.obj: C:\onyx\ext\onyx\url.zep.c
	$(CC) $(CFLAGS_ONYX_OBJ) $(CFLAGS) /Fo$(BUILD_DIR)\onyx\ext\onyx\ $(CFLAGS_BD_ONYX_EXT_ONYX) /c C:\onyx\ext\onyx\url.zep.c 
